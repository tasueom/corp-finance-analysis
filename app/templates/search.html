{% extends "layout.html" %}

{% block title %}
    기업 재무상태표 검색
{% endblock %}

{% block content %}
<h2>기업 재무상태표 검색</h2>
<p>기업 이름을 검색하여 OpenDart API를 통해 재무상태표 정보를 확인합니다.
<br>검색 결과를 불러오는데 시간이 다소 소요될 수 있습니다.
<br>KOSPI 상장 법인 이외에는 사업보고서가 존재하지 않을 수 있습니다.</p>

<div style="margin-bottom: 20px;">
    <input type="text" id="searchInput" placeholder="기업 이름을 입력하세요" 
           style="width: 300px; padding: 8px; font-size: 14px;"
           value="{{ corp_name if corp_name else '' }}">
    <button type="button" id="searchBtn" style="padding: 8px 16px; font-size: 14px;">검색</button>
</div>

<div id="corpList" style="display: none; margin-top: 20px; margin-bottom: 20px;">
    <h3>검색 결과</h3>
    <div id="corpListContent" style="border: 1px solid #ddd; border-radius: 4px; max-height: 300px; overflow-y: auto;">
        <!-- 기업 목록이 여기에 표시됩니다 -->
    </div>
</div>

<div id="loading" style="display: none; margin-top: 20px;">
    <p>재무상태표 데이터를 불러오는 중...</p>
</div>

{% if error %}
    <div style="color: red; margin-top: 20px;">
        <strong>오류:</strong> {{ error }}
    </div>
{% elif data %}
    <div style="margin-top: 30px;">
        <h3>{{ corp_name }} 재무상태표 데이터 (최근 10년치)</h3>
        <p>총 {{ row_count }}개의 데이터</p>
        <form method="post" action="{{ url_for('insert_data') }}" style="display: inline;">
            <input type="hidden" name="corp_name" value="{{ corp_name }}">
            <button type="submit">데이터베이스에 저장</button>
        </form>
        <table border="1" cellpadding="10" cellspacing="0" style="width: 100%; border-collapse: collapse; margin-top: 20px;">
            <thead>
                <tr style="background-color: #f0f0f0;">
                    {% for col in columns %}
                        <th>{{ col }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in data %}
                    <tr>
                        {% for col in columns %}
                            <td>
                                {% if col == 'year' %}
                                    {# 연도는 쉼표 없이 표시 #}
                                    {{ row[col] if row[col] else '-' }}
                                {% elif row[col] is number %}
                                    {{ "{:,}".format(row[col]) if row[col] else '-' }}
                                {% else %}
                                    {{ row[col] if row[col] else '-' }}
                                {% endif %}
                            </td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endif %}

<style>
.corp-item:hover {
    background-color: #f5f5f5 !important;
}
</style>
{% endblock %}

{% block scripts %}
<script>
    // Flask 템플릿 변수를 JS로 전달
    window.SEARCH_URL = '{{ url_for("search") }}';
</script>
<script src="{{ url_for('static', filename='js/search.js') }}"></script>
{% endblock %}
