# 기업 재무상태표 분석 시스템

DART(Data Analysis, Retrieval and Transfer system) Open API를 활용하여 기업의 재무상태표 데이터를 조회, 저장, 분석 및 시각화하는 웹 애플리케이션입니다.

## 📋 목차

- [주요 기능](#주요-기능)
- [기술 스택](#기술-스택)
- [프로젝트 구조](#프로젝트-구조)
- [설치 및 설정](#설치-및-설정)
  - [필수 요구사항](#1-필수-요구사항)
  - [패키지 설치](#2-패키지-설치)
  - [환경 변수 설정](#3-환경-변수-설정)
  - [데이터베이스 초기화](#4-데이터베이스-초기화)
- [실행 방법](#실행-방법)
- [사용 방법](#사용-방법)
  - [기업 검색 및 데이터 조회](#1-기업-검색-및-데이터-조회)
  - [저장된 데이터 조회](#2-저장된-데이터-조회)
  - [차트 시각화](#3-차트-시각화)
  - [재무제표 비교](#4-재무제표-비교)
  - [재무 지표 예측](#5-재무-지표-예측)
  - [이미지 텍스트 추출 (OCR)](#6-이미지-텍스트-추출-ocr)
  - [데이터 내보내기](#7-데이터-내보내기)
- [라우트 목록](#라우트-목록)
- [데이터 구조](#데이터-구조)
- [주요 기능 상세](#주요-기능-상세)
- [주의사항](#주의사항)
- [문제 해결](#문제-해결)
- [문서](#문서)
- [참고 자료](#참고-자료)

---

## 주요 기능

- 🔍 **기업 검색**: 검색어 입력 시 해당 검색어를 포함하는 기업 목록을 표시하고, 선택한 기업의 최근 10년치 재무상태표 데이터 조회
- 💾 **데이터 저장**: 조회한 재무상태표 데이터를 MySQL 데이터베이스에 저장
- 📊 **데이터 조회**: 저장된 기업별, 연도별 재무상태표 데이터 조회 및 재무지표 자동 계산
- 📈 **차트 시각화**: 자산총계 추이, 연도별 계정과목 분포, 자본/부채 구성 파이 차트 제공
- 📊 **재무제표 비교**: 여러 기업의 재무제표를 동시에 비교 분석
- 🔮 **재무 지표 예측**: 머신러닝을 활용한 재무 지표 예측
- 📸 **이미지 텍스트 추출**: OCR 기술을 활용한 이미지에서 텍스트 추출 (한국어/영어 지원)
- 📥 **데이터 내보내기**: CSV, JSON 형식으로 데이터 내보내기

## 기술 스택

- **Backend**: Python 3.x, Flask
- **Database**: MySQL
- **Data Processing**: pandas, scikit-learn
- **API**: DART Open API
- **OCR**: EasyOCR (한국어/영어 지원)
- **Image Processing**: PIL/Pillow, NumPy
- **Frontend**: HTML, CSS, JavaScript (Chart.js)

## 프로젝트 구조

```
corp-finance-analysis/
├── app/
│   ├── __init__.py          # Flask 앱 초기화
│   ├── routes.py            # 라우팅 및 요청 처리
│   ├── service.py           # 비즈니스 로직 (API 호출, 데이터 처리, PDF 생성)
│   ├── db.py                # 데이터베이스 연동
│   ├── cache.py             # 기업 코드 캐시 관리 (메모리 캐싱)
│   ├── templates/           # HTML 템플릿
│   │   ├── layout.html
│   │   ├── index.html
│   │   ├── search.html
│   │   ├── view.html
│   │   ├── chart.html
│   │   ├── compare.html
│   │   ├── predict.html
│   │   └── ocr.html
│   └── static/              # 정적 파일
│       ├── css/
│       │   └── style.css
│       ├── images/
│       │   ├── favicon.png
│       │   └── title.png
│       └── js/
│           ├── chart.js
│           ├── search.js
│           └── compare.js
├── app.py                   # 애플리케이션 진입점
├── init_db.py               # 데이터베이스 초기화 스크립트
├── README.md
├── 기술요소_정리.md           # 기술 스택 및 알고리즘 상세 설명
└── 캐싱_메커니즘_설명.md      # 기업 코드 검색 최적화 설명
```

## 설치 및 설정

### 1. 필수 요구사항

- Python 3.7 이상
- MySQL 5.7 이상
- DART Open API 키 ([DART Open API 홈페이지](https://opendart.fss.or.kr/)에서 발급)

### 2. 패키지 설치

```bash
pip install flask
pip install mysql-connector-python
pip install pandas
pip install python-dotenv
pip install requests
pip install easyocr
pip install pillow
pip install numpy
pip install scikit-learn
pip install opencv-python
```

### 3. 환경 변수 설정

프로젝트 루트 디렉토리에 `.env` 파일을 생성하고 다음 내용을 입력하세요:

```env
# DART API 설정
API_KEY=your_dart_api_key_here
BASE_URL=https://opendart.fss.or.kr/api

# 데이터베이스 설정
DB_HOST=localhost
DB_USER=root
DB_PASSWORD=your_password
DB_NAME=corpdb
TABLE_NAME=corp_finance

# Flask 설정
SECRET_KEY=your_secret_key_here
```

### 4. 데이터베이스 초기화

```bash
python init_db.py
```

이 스크립트는 다음 작업을 수행합니다:
- 데이터베이스 생성
- 기존 테이블 삭제 (있는 경우)
- 재무상태표 데이터 저장용 테이블 생성

## 실행 방법

```bash
python app.py
```

애플리케이션이 실행되면 브라우저에서 `http://localhost:5000`으로 접속할 수 있습니다.

## 사용 방법

### 1. 기업 검색 및 데이터 조회

1. 메인 페이지에서 "검색" 메뉴로 이동
2. 검색어 입력 (예: "삼성") - 정확한 기업명을 몰라도 검색어만으로 검색 가능
3. 검색 버튼 클릭 또는 Enter 키 입력
4. 검색 결과로 표시된 기업 목록에서 원하는 기업 선택
   - 각 기업은 기업명과 기업 코드가 함께 표시됩니다
   - 검색 결과를 불러오는데 시간이 다소 소요될 수 있습니다
5. 선택한 기업의 최근 10년치 재무상태표 데이터 확인
6. 필요시 "데이터 저장" 버튼으로 데이터베이스에 저장

### 2. 저장된 데이터 조회

1. "조회" 메뉴로 이동
2. 기업 선택
3. 연도 선택 (자동으로 최근 연도가 선택됨)
4. 해당 연도의 계정과목별 금액 확인
5. 재무지표 자동 계산 결과 확인:
6. 각 재무지표 항목에 마우스를 올리면 상세 설명 확인 가능

### 3. 차트 시각화

1. "차트" 메뉴로 이동
2. 기업 선택
3. 연도 선택
4. 다음 차트 확인:
   - **차트 1**: 자산총계 연도별 추이
   - **차트 2**: 선택한 연도의 계정과목별 금액 분포
   - **파이 차트**: 선택한 연도의 자본/부채 구성 비율

### 4. 재무제표 비교

1. "비교" 메뉴로 이동
2. 비교할 기업과 연도 선택 (여러 개 추가 가능)
3. "비교하기" 버튼 클릭
4. 비교 결과 테이블 및 차트 확인:
   - 기업별 계정과목 비교
   - 차이 금액 및 증감률 표시
   - 시각적 차트 비교

### 5. 재무 지표 예측

1. "예측" 메뉴로 이동
2. 기업 선택
3. 예측할 연도 입력
4. "예측 실행" 버튼 클릭
5. 예측 결과 확인:
   - 예측된 재무 지표 값
   - 모델 성능 지표 (R², RMSE)

### 6. 이미지 텍스트 추출 (OCR)

1. "이미지 분석" 메뉴로 이동
2. 이미지 파일 업로드 (JPG, PNG, GIF 등)
3. "텍스트 추출" 버튼 클릭
4. 추출된 텍스트 확인:
   - 업로드된 이미지 미리보기
   - 추출된 텍스트 목록 표시
   - 한국어 및 영어 텍스트 인식 지원

**참고**: 
- 이미지는 서버에 저장되지 않고 메모리에서 처리됩니다 (BytesIO 사용)
- 첫 실행 시 EasyOCR 모델 다운로드로 인해 시간이 소요될 수 있습니다

### 7. 데이터 내보내기

- "CSV 내보내기": 모든 저장된 데이터를 CSV 파일로 다운로드
- "JSON 내보내기": 모든 저장된 데이터를 JSON 파일로 다운로드

## 라우트 목록

### 웹 페이지 라우트 (HTML 반환)

| 경로 | 메서드 | 설명 |
|------|--------|------|
| `/` | GET | 메인 페이지 (README 표시) |
| `/search` | GET, POST | 기업 검색 및 재무상태표 조회 페이지 |
| `/view` | GET, POST | 저장된 데이터 조회 페이지 |
| `/chart` | GET, POST | 차트 시각화 페이지 |
| `/compare` | GET, POST | 재무제표 비교 페이지 |
| `/predict` | GET, POST | 재무 지표 예측 페이지 |
| `/ocr` | GET, POST | 이미지 텍스트 추출 (OCR) 페이지 |
| `/insert_data` | POST | 재무상태표 데이터 저장 (리다이렉트) |

### API 엔드포인트 (JSON/파일 반환)

| 경로 | 메서드 | 설명 |
|------|--------|------|
| `/api/search_corps` | GET | 검색어로 기업 목록 조회 (JSON) |
| `/chart1_data/<corp>` | GET | 자산총계 추이 데이터 (JSON) |
| `/chart2_data/<corp>/<year>` | GET | 연도별 계정과목 데이터 (JSON) |
| `/pie_data/<corp>/<year>` | GET | 자본/부채 파이 차트 데이터 (JSON) |
| `/chart2_data` | POST | 비교 차트 데이터 (JSON) |
| `/api/get_years` | GET | 기업별 연도 목록 조회 (JSON) |
| `/export_csv` | GET | CSV 파일 다운로드 |
| `/export_json` | GET | JSON 파일 다운로드 |

## 데이터 구조

### 재무상태표 데이터 (corp_finance 테이블)

| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| id | INT | 기본 키 (자동 증가) |
| corp_name | VARCHAR(100) | 기업 이름 |
| corp_code | VARCHAR(20) | DART 기업 코드 |
| account_nm | VARCHAR(100) | 계정과목명 |
| amount | BIGINT | 금액 |
| year | INT | 연도 |

## 주요 기능 상세

### 기업 검색 기능

- 검색어 입력 시 DART API의 기업 코드 목록에서 해당 검색어를 포함하는 기업을 검색
- 부분 일치 검색 지원: 정확한 기업명을 몰라도 검색어만으로 기업을 찾을 수 있음
- 최대 50개의 검색 결과 표시
- 검색 결과에서 기업명과 기업 코드를 함께 표시하여 정확한 기업 선택 가능

#### ⚡ 성능 최적화: 메모리 캐싱

- **기존 방식**: 매번 검색 시 DART API 호출 (약 3-5초 소요)
- **개선된 방식**: 서버 시작 시 한 번만 기업 목록을 다운로드하여 메모리에 캐싱
- **성능 향상**: 검색 응답 시간이 **수 밀리초**로 단축 (약 1000배 이상 빠름)
- **동작 방식**: Flask 앱 시작 시 백그라운드 스레드에서 자동으로 기업 코드 목록 로드
- **상세 설명**: [캐싱 메커니즘 설명 문서](./캐싱_메커니즘_설명.md) 참고

### 재무상태표 데이터 조회

- DART API를 통해 최근 10년치 재무상태표 데이터를 자동으로 조회
- 3년 단위로 효율적으로 데이터 수집 (사업보고서에 당기, 전기, 전전기 데이터 포함)
- 재무상태표(BS) 데이터만 조회하여 데이터량 최적화

### 데이터 저장 로직

- 중복 데이터 체크: 동일 기업의 동일 연도 데이터가 이미 존재하면 저장하지 않음
- 데이터 갱신: 기존 데이터의 최근 연도와 다르면 기존 데이터 삭제 후 새 데이터 저장
- NaN 값 처리: 결측값은 NULL로 저장

### 재무지표 계산 기능

- 저장된 재무상태표 데이터를 기반으로 주요 재무지표를 자동 계산
- 계산되는 재무지표:
  - **유동비율**: 유동자산을 유동부채로 나눈 비율 (단기 채무 상환 능력)
  - **당좌비율**: 재고를 제외한 순 유동자산으로 단기 채무를 상환할 수 있는 능력
  - **부채비율**: 부채가 자산에서 차지하는 비율 (재무 안정성)
  - **부채자본비율**: 부채와 자본의 비율 (재무 레버리지)
  - **자기자본비율**: 자기 자본으로 운영하는 비율 (자립도)
- 각 재무지표 항목에 호버 시 상세 설명 툴팁 제공
- 데이터가 없는 경우 자동으로 '-' 표시

### 재무제표 비교 기능

- 여러 기업의 재무제표를 동시에 비교 분석
- 차이 금액 및 증감률 자동 계산
- Sticky 컬럼을 활용한 스크롤 가능한 비교 테이블
- 시각적 차트 비교 제공

### 재무 지표 예측 기능

- 선형 회귀 모델을 활용한 재무 지표 예측
- 다중 계정과목 동시 예측 지원
- 모델 성능 지표 제공 (R², RMSE)
- 기업별 맞춤 예측 모델

### 이미지 텍스트 추출 (OCR) 기능

- EasyOCR을 활용한 한국어/영어 텍스트 인식
- 이미지 파일을 메모리에서 처리 (BytesIO 사용)
- 서버에 파일 저장 없이 즉시 처리
- Base64 인코딩을 통한 이미지 미리보기 제공

## 주의사항

1. **API 키**: DART Open API 키가 필요합니다. 무료로 발급받을 수 있지만 일일 호출 제한이 있을 수 있습니다.
2. **데이터베이스**: MySQL 서버가 실행 중이어야 합니다.
3. **기업 검색**: 검색어만으로도 기업을 찾을 수 있지만, 정확한 기업명을 알고 있으면 더 빠르게 검색할 수 있습니다.
4. **캐시 로딩**: 서버 시작 직후 수 초간은 기업 코드 캐시가 로딩 중일 수 있어 검색 결과가 비어있을 수 있습니다. 캐시 로딩이 완료되면 즉시 검색 가능합니다.
5. **데이터 조회 시간**: 10년치 데이터 조회 시 다소 시간이 걸릴 수 있습니다.
6. **OCR 모델**: EasyOCR 모델이 처음 실행 시 자동으로 다운로드되므로 초기 실행에 시간이 소요될 수 있습니다.
7. **이미지 처리**: OCR 기능은 이미지를 서버에 저장하지 않고 메모리에서 처리합니다.

## 문제 해결

### API 키 오류
- `.env` 파일에 올바른 `API_KEY`가 설정되어 있는지 확인
- DART Open API 홈페이지에서 API 키가 활성화되어 있는지 확인

### 데이터베이스 연결 오류
- MySQL 서버가 실행 중인지 확인
- `.env` 파일의 데이터베이스 설정이 올바른지 확인
- 데이터베이스가 생성되었는지 확인 (`init_db.py` 실행)

### 데이터 조회 실패
- 인터넷 연결 확인
- 검색어가 너무 짧거나 일반적인 단어인 경우 많은 결과가 나올 수 있음 (더 구체적인 검색어 사용 권장)
- DART API 일일 호출 제한 확인
- 기업 목록 검색이 느린 경우: 서버 시작 직후 캐시 로딩 중일 수 있습니다. 잠시 후 다시 시도해주세요

### OCR 오류
- EasyOCR 모델이 다운로드되지 않은 경우: 첫 실행 시 자동으로 다운로드되므로 시간이 소요될 수 있습니다
- 이미지 파일 형식 확인: JPG, PNG, GIF 등 지원되는 형식인지 확인
- 메모리 부족: 큰 이미지 파일의 경우 메모리 사용량이 증가할 수 있습니다

## 라이선스

이 프로젝트는 부트캠프 팀 과제로 제작되었으며, 교육 목적으로만 사용됩니다.

## 문서

- [기술 요소 및 알고리즘 정리](./기술요소_정리.md) - 프로젝트의 핵심 기술 스택, 알고리즘, 아키텍처 상세 설명
- [캐싱 메커니즘 설명](./캐싱_메커니즘_설명.md) - 기업 코드 검색 최적화: 기존 방식 vs 메모리 캐싱 방식 상세 비교

## 참고 자료

- [DART Open API 공식 문서](https://opendart.fss.or.kr/guide/main.do)
- [Flask 공식 문서](https://flask.palletsprojects.com/)
- [MySQL 공식 문서](https://dev.mysql.com/doc/)
- [EasyOCR GitHub](https://github.com/JaidedAI/EasyOCR)
- [scikit-learn 공식 문서](https://scikit-learn.org/)
